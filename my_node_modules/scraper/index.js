var http = require('http');
var cheerio = require('cheerio');
var evements = [];

exports.WebScrapper = function() {
		
	return evements; //[{nom: "nn", salle: "ss", date: "dd"}, {..}, ..];
};

function CollectWebPage(url, path, func){
	var data = '';

	var request = http.request({host: url, path: path}, function (res) {
		
		res.on('data', function (chunk) {
			data += chunk;
		});
		
		res.on('end', function () {
			func(data);
		});
	});
	
	request.on('error', function (e) {
		console.log(e.message);
	});
	
	request.end();
}

function parseSpectacleOttawa(data)
{
	const $ = cheerio.load(data);
	$('.vevent').each(function(i, elem) {
		spectacle = $(elem).find('h2').text();
		date = $(elem).find('.value-title').attr('title');
		location = $(elem).find('.location').text();
		
		evenement = {nom: spectacle, salle: location, date: date};
		evements.push(evenement);
	});

}

function parseMaisonCulture(data)
{
	const $ = cheerio.load(data);
	$('.artist-details').each(function(i, elem) {
		location = "Salle Odyssee";
		spectacle = $(elem).find('strong').text();
		date = $(elem).text().split('\n');
		date = date[date.length - 2];	
		evenement = {nom: spectacle, salle: location, date: date};
		evements.push(evenement);
	});
}

CollectWebPage("www.spectacle.ca", '/ottawa', parseSpectacleOttawa);
CollectWebPage("www.maisondelaculture.ca", '/salle-odyssee/spectacles/tous-les-spectacles/index.html', parseMaisonCulture);